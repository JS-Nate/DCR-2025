flowchart LR
  %% External producers/consumers
  subgraph EXT[External Systems]
    HMS[Human Monitoring System<br/>(biometric/behavioral/env data)]
    HSIM[Human Simulator<br/>(synthetic/scenario data)]
    HPMS[HPMS Decision Engine<br/>& Actuators/UI]
  end

  %% HPSN module
  subgraph M5[Module 5 — Human Performance Semantic Network (HPSN)]
    dir TB

    M5_1[5.1 Build & Maintain Knowledge Model<br/><sub>ontology, input→measure mappings, thresholds, model cards</sub>]

    M5_2[5.2 Gather & Prepare Real‑Time Data<br/><sub>schema/units/timestamp checks; light validation</sub>]

    M5_3[5.3 Map Inputs to Performance Context<br/><sub>activate relevant nodes; adjust by situation; bind to task</sub>]

    M5_4[5.4 Interpret Current Human State<br/><sub>fuse evidence → PSFs & measures; generate explanation_id</sub>]

    M5_5[5.5 Predict Future Performance<br/><sub>forecast; what‑if; early‑warning</sub>]

    M5_6[5.6 Assess Safety Impact & Reliability<br/><sub>compare to thresholds; prioritize risks</sub>]

    M5_7[5.7 Recommend Corrective Actions<br/><sub>ranked interventions with expected benefit & confidence</sub>]

    M5_8[5.8 Carry Out & Verify Actions<br/><sub>verify post‑action effect (5.8.3)</sub>]

    M5_9[5.9 Learn & Improve the Network<br/><sub>update weights, thresholds; personalize</sub>]

    M5_10[5.10 Record & Report Decisions<br/><sub>log inferences, predictions, recommendations, explanations</sub>]
  end

  %% Data ingress to HPSN
  HMS -->|live signals| M5_2
  HSIM -->|scenario signals| M5_2

  %% Core reasoning flow
  M5_2 --> M5_3 --> M5_4 --> M5_5 --> M5_6 --> M5_7 --> HPMS

  %% Actions + feedback loop
  HPMS -->|implements actions| HPMS
  HPMS -->|post‑action data / effectiveness| M5_8
  M5_8 --> M5_9
  M5_9 --> M5_3

  %% Knowledge & logging backbones
  M5_1 -. provides mappings/thresholds .-> M5_3
  M5_1 -. provides models .-> M5_4
  M5_1 -. provides profiles .-> M5_6
  M5_10 --- M5_4
  M5_10 --- M5_5
  M5_10 --- M5_6
  M5_10 --- M5_7
  M5_10 --- M5_8

  %% HPMS configuration stage
  M5_1 -->|get_config_bundle()<br/>measure catalog, mappings, thresholds| HPMS
